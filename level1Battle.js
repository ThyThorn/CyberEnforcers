var gameLevel1 = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
];

var background;
var backgroundVir;
var moveButton;
var battleTheme1;
var kaito;
var virus;
var scaleFactor = 16;
var kaitoObject;
var virusObject;
var playerTeam = new Array();
var enemyTeam = new Array();
var level1Width = 30; // Will be used to make copying code for the other levels easier,
var level1Height = 30; // since it will involve only changing variable names and not hardcoded values.
var xSelected;
var ySelected;
var turnNumber = 1;

var level1Battle = function(game) {};
level1Battle.prototype = {
	preload: function() {
        game.load.atlas('atlas', 'phaser/myGame/assets/allSprites.png', 'phaser/myGame/assets/allSprites.json'); // Load the atlas.
		game.load.image('background', 'phaser/myGame/assets/level1.png');
		game.load.image('backgroundVir', 'phaser/myGame/assets/level1v.png');
		game.load.image('greenTile', 'phaser/myGame/assets/highlight.png');
		game.load.image('moveButton', 'phaser/myGame/assets/movefullicon.png');
    	game.load.audio('battleTheme1', 'phaser/myGame/bgm/Fighting is not an option.mp3');
	},

	create: function() {
		game.scale.setGameSize(960, 530);
		game.physics.startSystem(Phaser.Physics.ARCADE);
		background = game.add.sprite(0, 0, 'background');
		background.inputEnabled = true;
        background.events.onInputDown.add(chooseUnit, this);
		backgroundVir = game.add.sprite(game.world.width/2, 0, 'backgroundVir');
		moveButton = game.add.button(0, game.world.height - 50, 'moveButton', moveUnit, this);
        battleTheme1 = game.add.audio('battleTheme1');
        battleTheme1.loop = true;
        battleTheme1.play();
        kaitoObject = new Level1Unit('Kaito', 20, 10, 5, 10, 'player', false, 19, 3, 'atlas', 'kaito01');
        game.add.existing(kaitoObject);
        kaitoObject1 = new Level1Unit('Kaito1', 20, 10, 5, 10, 'player', false, 14, 10, 'atlas', 'kaito01');
        game.add.existing(kaitoObject1);
        kaitoObject2 = new Level1Unit('Kaito2', 20, 10, 5, 10, 'player', false, 7, 23, 'atlas', 'kaito01');
        game.add.existing(kaitoObject2);
        virusObject = new Level1Unit('Virus', 25, 5, 5, 10, 'enemy', true, 15, 13, 'atlas', 'kenta01');
        game.add.existing(virusObject);
        virusObject1 = new Level1Unit('Virus', 25, 5, 5, 10, 'enemy', true, 20, 3, 'atlas', 'kenta01');
        game.add.existing(virusObject1);
        virusObject2 = new Level1Unit('Virus', 25, 5, 5, 10, 'enemy', true, 7, 24, 'atlas', 'kenta01');
        game.add.existing(virusObject2);
	},
	update: function(){
	}
}

var chosenSquare = false;
var movePressed = false;
var chosenX;
var chosenY;

function setInvisible() {
    for(var i = 0; i < playerTeam.length; i++) {
        playerTeam[i].pathTiles.visible = false;
    }
    for(var i = 0; i < enemyTeam.length; i++) {
        enemyTeam[i].pathTiles.visible = false;
    }
}

function moveUnit() {
    setInvisible();
    movePressed = !movePressed;
}

var newThing;
var newX;
var newY;

function chooseUnit() {
    chosenX = Math.floor(game.input.mousePointer.x / 16);
    chosenY = Math.floor(game.input.mousePointer.y / 16);
    if(gameLevel1[chosenX][chosenY] instanceof Level1Unit) {
        setInvisible();
        gameLevel1[chosenX][chosenY].pathFinder();
        if(doNotShow == true) {
            setInvisible();
        }
        if(turnNumber % 2 == 1) {
            if(gameLevel1[chosenX][chosenY].team == 'player') {
                if(movePressed == true) {
                    chosenSquare = true;
                    xSelected = 0;
                    ySelected = 0;
                    newThing = gameLevel1[chosenX][chosenY];
                    newX = gameLevel1[chosenX][chosenY].xPlace;
                    newY = gameLevel1[chosenX][chosenY].yPlace;
                    background.events.onInputDown.add(clickSquare, this, {newUnit: newThing, 
                        xCoord: newX, yCoord: newY});
                }
                else {
                    doNotShow = false;
                }
            }
        }
    } 
    else {
        setInvisible();
        movePressed = false;
    }
}

var doNotShow = false;

function clickSquare() {
    var newUnit = newThing;
    var xCoord = newX;
    var yCoord = newY;
    if(chosenSquare == true) {
        xSelected = Math.floor(game.input.mousePointer.x / 16);
        ySelected = Math.floor(game.input.mousePointer.y / 16);
        console.log('xSelected' + xSelected);
        console.log('ySelected' + ySelected);
        if((xSelected >= 0 && xSelected < 30) && (ySelected >= 0 && ySelected < 30)) {
            if((gameLevel1[xSelected][ySelected] instanceof Level1Unit) == false) {
                gameLevel1[xSelected][ySelected] = newUnit;
                console.log(gameLevel1[xSelected][ySelected].xPlace);
                newUnit.xPlace = xSelected;
                newUnit.yPlace = ySelected;
                gameLevel1[xCoord][yCoord] = 0;
                changeSprite(newUnit);
            }
        }
    }
}

function changeSprite(change) {
    if(chosenSquare == true) {
    	change.x = change.xPlace * 16;
    	change.y = change.yPlace * 16;
    	change.pathTiles.removeAll();
        change.enemyLeft = false;
        change.enemyRight = false;
        change.enemyUp = false;
        change.enemyDown = false;
        change.pathsFound = false;
        chosenSquare = false;
        moveUnit();
        doNotShow = true;
        turnEnd(change.team);
    }
}

function turnEnd (player) {             // if all characters on red team turnEnd == true, set all blue team member   turnEnd == false
    if(playerTeam.length == 0) {
        console.log("I lose!");
    }
    else if(enemyTeam.length == 0) {
        console.log("I win!");
    }
}
