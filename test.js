var gameLevel1 = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
];

var background;
var backgroundVir;
var moveButton;
var battleTheme1;
var kaito;
var virus;
var scaleFactor = 16;
var kaitoObject;
var virusObject;
var playerTeam = new Array();
var enemyTeam = new Array();
var level1Width = 30; // Will be used to make copying code for the other levels easier,
var level1Height = 30; // since it will involve only changing variable names and not hardcoded values.
var xSelected;
var ySelected;

var level1Battle = function(game) {};
level1Battle.prototype = {
	preload: function() {
        game.load.atlas('atlas', 'phaser/myGame/assets/allSprites.png', 'phaser/myGame/assets/allSprites.json'); // Load the atlas.
		game.load.image('background', 'phaser/myGame/assets/level1.png');
		game.load.image('backgroundVir', 'phaser/myGame/assets/level1v.png');
		game.load.image('greenTile', 'phaser/myGame/assets/highlight.png');
		game.load.image('moveButton', 'phaser/myGame/assets/movefullicon.png');
    	game.load.audio('battleTheme1', 'phaser/myGame/bgm/Fighting is not an option.mp3');
	},

	create: function() {
		game.scale.setGameSize(960, 530);
		game.physics.startSystem(Phaser.Physics.ARCADE);
		background = game.add.sprite(0, 0, 'background');
		background.inputEnabled = true;
		backgroundVir = game.add.sprite(game.world.width/2, 0, 'backgroundVir');
		//moveButton = game.add.button(0, game.world.height - 50, 'moveButton', chooseSquare, this);
        battleTheme1 = game.add.audio('battleTheme1');
        battleTheme1.loop = true;
        battleTheme1.play();
        kaitoObject = new Level1Unit('Kaito', 20, 10, 5, 10, 'player', false, 19, 3, 'atlas', 'kaito01');
        game.add.existing(kaitoObject);
        virusObject = new Level1Unit('Virus', 25, 5, 5, 10, 'enemy', true, 15, 13, 'atlas', 'kenta01');
        game.add.existing(virusObject)
        virusObject1 = new Level1Unit('Virus', 25, 5, 5, 10, 'enemy', true, 20, 3, 'atlas', 'kenta01');
        game.add.existing(virusObject1);
        virusObject2 = new Level1Unit('Virus', 25, 5, 5, 10, 'enemy', true, 7, 24, 'atlas', 'kenta01');
        game.add.existing(virusObject2);
	},
	update: function(){
	}
}

var chosenSquare = false;
var newX;
var newY;

/*function chooseSquare() {
	chosenSquare = !chosenSquare;
}*/

function clickSquare() {
	var newUnit = this;
	var xCoord = this.xPlace;
	var yCoord = this.yPlace;
	if(chosenSquare == true) {
		xSelected = Math.floor(game.input.mousePointer.x / 16);
		ySelected = Math.floor(game.input.mousePointer.y / 16);
		if((xSelected >= 0 && xSelected < 30) && (ySelected >= 0 && ySelected < 30)) {
			if((gameLevel1[xSelected][ySelected] instanceof Level1Unit) == false) {
				gameLevel1[xSelected][ySelected] = newUnit;
				this.xPlace = xSelected;
				this.yPlace = ySelected;
				gameLevel1[xCoord][yCoord] = 0;
				changeSprite(this);
			}
		}
	}
}

function changeSprite(change) {
    if(chosenSquare == true) {
    	change.pathTiles.visible = false;
    	change.x = change.xPlace * 16;
    	change.y = change.yPlace * 16;
    	change.pathTiles.removeAll();
    	change.pathsFound = false;
        enemyLeft = false;
        enemyRight = false;
        enemyUp = false;
        enemyDown = false;
        chosenSquare = false;
    }
}

function turnEnd (player) {             // if all characters on red team turnEnd == true, set all blue team member   turnEnd == false
    if(player == 'player')
    {
        var counter = 0;
        for(var i = 0; i < playerTeam.length ; i++)
        {
            if(playerTeam[i].moveCount >= 2)
            {
                counter ++;
            }
        }
        if(counter >= playerTeam.length )
        {
            for(var i = 0; i < playerTeam.length; i++)
            {
                playerTeam[i].turnEnd = true;
                playerTeam[i].moveCount = 0;
            }
            for(var i =0; i < teamBlue.length ; i++)
            {
                enemyTeam[i].turnEnd = false;
            }
        }
    }
    else
    {
        var counter = 0;
        for(var i = 0; i < enemyTeam.length; i++)
        {
            if(enemyTeam[i].moveCount >= 2)
            {
                counter++;
            }
        }
        if(counter >= enemyTeam.length)
        {
            for(var i = 0; i < enemyTeam.length; i++)
            {
                enemyTeam[i].turnEnd = true;
                enemyTeam[i].moveCount = 0;
            }
            for(var i =0; i < teamRed.length; i++)
            {
                playerTeam[i].turnEnd = false;
            }
        }
    }
}
